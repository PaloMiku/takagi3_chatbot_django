{% extends 'base.html' %}
{% load static %}
{% block title %}个人设置{% endblock %}
{% block content %}
<div class="container mt-4" style="max-width:720px;">
  <h3>个人模型配置</h3>
  {% if saved %}<div class="alert alert-success">已保存</div>{% endif %}
  {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
  <form method="post">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label">昵称</label>
      <input name="nickname" class="form-control" value="{{ request.user.username }}" maxlength="150" />
    </div>
    <div class="mb-3">
      <label class="form-label">模型名称</label>
      <input name="modelName" class="form-control" value="{{ user_setting.modelName }}" placeholder="例如 gpt-3.5-turbo 或 deepseek-chat" />
    </div>
    <div class="mb-3">
      <label class="form-label">自定义 API Key (优先使用)</label>
      <input name="user_api_key" class="form-control" value="{{ user_setting.user_api_key }}" placeholder="sk-..." />
    </div>
    <div class="mb-3">
      <label class="form-label">自定义 Base URL (可选)</label>
      <input name="user_base_url" class="form-control" value="{{ user_setting.user_base_url }}" placeholder="https://api.openai.com/v1" />
    </div>
    <div class="mb-3">
      <label class="form-label">头像图片 URL (可选)</label>
      <input name="avatar_url" class="form-control" value="{{ user_setting.avatar_url }}" placeholder="https://.../avatar.png" />
      <small class="form-text text-muted">留空则继续使用邮箱生成的默认头像。</small>
    </div>
    <p class="text-muted small">提示：prompt 不可在此页面修改。如需全局摘要指令请到后台 BotSetting。</p>
    <button class="btn btn-primary" type="submit">保存</button>
    <a class="btn btn-secondary" href="/">返回聊天</a>
  <hr />
  <h4>修改密码</h4>
  {% if password_changed %}
    <div class="alert alert-success">已成功修改密码，请使用新密码登录（已自动退出会话）</div>
  {% endif %}
  {% if password_error %}
    <div class="alert alert-danger">{{ password_error }}</div>
  {% endif %}
  <form method="post" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label">旧密码</label>
      <input name="old_password" type="password" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">新密码</label>
      <input name="new_password1" type="password" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">再次输入新密码</label>
      <input name="new_password2" type="password" class="form-control" />
    </div>
    <button class="btn btn-warning" type="submit">修改密码</button>
  </form>
{% endblock %}
